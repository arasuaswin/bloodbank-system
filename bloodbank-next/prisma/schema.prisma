generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model blood_request {
  id         Int       @id @default(autoincrement())
  reci_name  String    @db.VarChar(50)
  reci_bgrp  String    @db.VarChar(5)
  reci_bqnty Int
  reci_id    Int
  urgency    String?   @default("Normal") @db.VarChar(20)   // Normal / Urgent / Critical
  purpose    String?   @db.VarChar(50)                       // Surgery / Accident / Thalassemia / Cancer / Pregnancy / Other
  hospital   String?   @db.VarChar(100)                      // Requesting hospital name
  status     String?   @default("PENDING") @db.VarChar(20)   // PENDING / APPROVED / REJECTED
  created_at DateTime? @default(now())
  
  // Relations
  recipient  recipient @relation(fields: [reci_id, reci_name], references: [reci_id, reci_name], onDelete: Cascade)

  @@index([reci_id, reci_name])
}

model blood_stock {
  stockid Int    @id @default(autoincrement())
  b_grp   String @db.VarChar(5)
  B_qnty  Int?   @default(0)
}

model donor {
  D_id            Int      @id @default(autoincrement())
  D_name          String?  @db.VarChar(50)
  D_age           Int?
  D_sex           String?  @db.VarChar(10)
  D_phno          String?  @unique @db.VarChar(15)
  D_bgrp          String?  @db.VarChar(5)
  HLevel          String?  @db.VarChar(20)
  BS              String?  @db.VarChar(20)
  BP              String?  @db.VarChar(20)
  rdate           DateTime? @db.Date
  eligibility     String?  @db.VarChar(100)
  D_weight        Int?
  D_email         String?  @db.VarChar(100)
  D_address       String?  @db.VarChar(200)
  last_donation   DateTime? @db.Date
  diseases        String?  @db.VarChar(255)
  password        String?  @db.VarChar(100)
  D_state         String?  @db.VarChar(50)                   // Indian state/UT
  D_aadhaar       String?  @db.VarChar(4)                    // Last 4 digits of Aadhaar
  D_donation_type String?  @default("Whole Blood") @db.VarChar(20) // Whole Blood / Platelets / Plasma
  D_units_donated Int?     @default(0)                       // Lifetime units donated
  appointments appointment[]
}

model verification_token {
  identifier String
  token      String
  expires    DateTime

  @@unique([identifier, token])
}

model appointment {
  id            Int      @id @default(autoincrement())
  donor_id      Int
  donor         donor    @relation(fields: [donor_id], references: [D_id])
  date          DateTime
  status        String   @default("PENDING") // PENDING, APPROVED, REJECTED, COMPLETED
  donation_type String?  @default("Whole Blood") @db.VarChar(20)  // Whole Blood / Platelets / Plasma
  units         Int?     @default(1)                               // Units to donate
  notes         String?  @db.VarChar(255)                          // Admin notes
  created_at    DateTime @default(now())

  @@index([donor_id])
}

model recipient {
  reci_id       Int       @default(autoincrement())
  reci_name     String    @db.VarChar(50)
  reci_age      Int?
  reci_sex      String?   @db.VarChar(10)
  reci_phno     String?   @db.VarChar(15)
  reci_bgrp     String?   @db.VarChar(5)
  reci_reg_date DateTime? @db.Date
  reci_hospital String?   @db.VarChar(100)                   // Hospital name
  reci_doctor   String?   @db.VarChar(50)                    // Attending doctor
  reci_address  String?   @db.VarChar(200)                   // Patient address
  reci_urgency  String?   @default("Normal") @db.VarChar(20) // Normal / Urgent / Critical
  reci_purpose  String?   @db.VarChar(50)                    // Surgery / Accident / etc.

  // Relations
  blood_requests blood_request[]

  @@id([reci_id, reci_name])
}

model users {
  id       Int    @id @default(autoincrement())
  name     String @db.VarChar(50)
  email    String @unique @db.VarChar(100)
  phone    String @db.VarChar(15)
  password String @db.VarChar(100)
}
